{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport { BaseLoggger, Html5QrcodeResultFactory, Html5QrcodeErrorFactory, Html5QrcodeSupportedFormats, isValidHtml5QrcodeSupportedFormats, Html5QrcodeConstants, isNullOrUndefined } from \"./core\";\nimport { Html5QrcodeStrings } from \"./strings\";\nimport { VideoConstraintsUtil } from \"./utils\";\nimport { Html5QrcodeShim } from \"./code-decoder\";\nimport { CameraFactory } from \"./camera/factories\";\nimport { CameraRetriever } from \"./camera/retriever\";\nimport { StateManagerFactory, Html5QrcodeScannerState } from \"./state-manager\";\nvar Constants = function (_super) {\n  __extends(Constants, _super);\n  function Constants() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  Constants.DEFAULT_WIDTH = 300;\n  Constants.DEFAULT_WIDTH_OFFSET = 2;\n  Constants.FILE_SCAN_MIN_HEIGHT = 300;\n  Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING = 100;\n  Constants.MIN_QR_BOX_SIZE = 50;\n  Constants.SHADED_LEFT = 1;\n  Constants.SHADED_RIGHT = 2;\n  Constants.SHADED_TOP = 3;\n  Constants.SHADED_BOTTOM = 4;\n  Constants.SHADED_REGION_ELEMENT_ID = \"qr-shaded-region\";\n  Constants.VERBOSE = false;\n  Constants.BORDER_SHADER_DEFAULT_COLOR = \"#ffffff\";\n  Constants.BORDER_SHADER_MATCH_COLOR = \"rgb(90, 193, 56)\";\n  return Constants;\n}(Html5QrcodeConstants);\nvar InternalHtml5QrcodeConfig = function () {\n  function InternalHtml5QrcodeConfig(config, logger) {\n    this.logger = logger;\n    this.fps = Constants.SCAN_DEFAULT_FPS;\n    if (!config) {\n      this.disableFlip = Constants.DEFAULT_DISABLE_FLIP;\n    } else {\n      if (config.fps) {\n        this.fps = config.fps;\n      }\n      this.disableFlip = config.disableFlip === true;\n      this.qrbox = config.qrbox;\n      this.aspectRatio = config.aspectRatio;\n      this.videoConstraints = config.videoConstraints;\n    }\n  }\n  InternalHtml5QrcodeConfig.prototype.isMediaStreamConstraintsValid = function () {\n    if (!this.videoConstraints) {\n      this.logger.logError(\"Empty videoConstraints\", true);\n      return false;\n    }\n    return VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints, this.logger);\n  };\n  InternalHtml5QrcodeConfig.prototype.isShadedBoxEnabled = function () {\n    return !isNullOrUndefined(this.qrbox);\n  };\n  InternalHtml5QrcodeConfig.create = function (config, logger) {\n    return new InternalHtml5QrcodeConfig(config, logger);\n  };\n  return InternalHtml5QrcodeConfig;\n}();\nvar Html5Qrcode = function () {\n  function Html5Qrcode(elementId, configOrVerbosityFlag) {\n    this.element = null;\n    this.canvasElement = null;\n    this.scannerPausedUiElement = null;\n    this.hasBorderShaders = null;\n    this.borderShaders = null;\n    this.qrMatch = null;\n    this.renderedCamera = null;\n    this.qrRegion = null;\n    this.context = null;\n    this.lastScanImageFile = null;\n    this.isScanning = false;\n    if (!document.getElementById(elementId)) {\n      throw \"HTML Element with id=\".concat(elementId, \" not found\");\n    }\n    this.elementId = elementId;\n    this.verbose = false;\n    var experimentalFeatureConfig;\n    var configObject;\n    if (typeof configOrVerbosityFlag == \"boolean\") {\n      this.verbose = configOrVerbosityFlag === true;\n    } else if (configOrVerbosityFlag) {\n      configObject = configOrVerbosityFlag;\n      this.verbose = configObject.verbose === true;\n      experimentalFeatureConfig = configObject.experimentalFeatures;\n    }\n    this.logger = new BaseLoggger(this.verbose);\n    this.qrcode = new Html5QrcodeShim(this.getSupportedFormats(configOrVerbosityFlag), this.getUseBarCodeDetectorIfSupported(configObject), this.verbose, this.logger);\n    this.foreverScanTimeout;\n    this.shouldScan = true;\n    this.stateManagerProxy = StateManagerFactory.create();\n  }\n  Html5Qrcode.prototype.start = function (cameraIdOrConfig, configuration, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n    if (!cameraIdOrConfig) {\n      throw \"cameraIdOrConfig is required\";\n    }\n    if (!qrCodeSuccessCallback || typeof qrCodeSuccessCallback != \"function\") {\n      throw \"qrCodeSuccessCallback is required and should be a function.\";\n    }\n    var qrCodeErrorCallbackInternal;\n    if (qrCodeErrorCallback) {\n      qrCodeErrorCallbackInternal = qrCodeErrorCallback;\n    } else {\n      qrCodeErrorCallbackInternal = this.verbose ? this.logger.log : function () {};\n    }\n    var internalConfig = InternalHtml5QrcodeConfig.create(configuration, this.logger);\n    this.clearElement();\n    var videoConstraintsAvailableAndValid = false;\n    if (internalConfig.videoConstraints) {\n      if (!internalConfig.isMediaStreamConstraintsValid()) {\n        this.logger.logError(\"'videoConstraints' is not valid 'MediaStreamConstraints, \" + \"it will be ignored.'\", true);\n      } else {\n        videoConstraintsAvailableAndValid = true;\n      }\n    }\n    var areVideoConstraintsEnabled = videoConstraintsAvailableAndValid;\n    var element = document.getElementById(this.elementId);\n    var rootElementWidth = element.clientWidth ? element.clientWidth : Constants.DEFAULT_WIDTH;\n    element.style.position = \"relative\";\n    this.shouldScan = true;\n    this.element = element;\n    var $this = this;\n    var toScanningStateChangeTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);\n    return new Promise(function (resolve, reject) {\n      var videoConstraints = areVideoConstraintsEnabled ? internalConfig.videoConstraints : $this.createVideoConstraints(cameraIdOrConfig);\n      if (!videoConstraints) {\n        toScanningStateChangeTransaction.cancel();\n        reject(\"videoConstraints should be defined\");\n        return;\n      }\n      var cameraRenderingOptions = {};\n      if (!areVideoConstraintsEnabled || internalConfig.aspectRatio) {\n        cameraRenderingOptions.aspectRatio = internalConfig.aspectRatio;\n      }\n      var renderingCallbacks = {\n        onRenderSurfaceReady: function (viewfinderWidth, viewfinderHeight) {\n          $this.setupUi(viewfinderWidth, viewfinderHeight, internalConfig);\n          $this.isScanning = true;\n          $this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallbackInternal);\n        }\n      };\n      CameraFactory.failIfNotSupported().then(function (factory) {\n        factory.create(videoConstraints).then(function (camera) {\n          return camera.render(_this.element, cameraRenderingOptions, renderingCallbacks).then(function (renderedCamera) {\n            $this.renderedCamera = renderedCamera;\n            toScanningStateChangeTransaction.execute();\n            resolve(null);\n          }).catch(function (error) {\n            toScanningStateChangeTransaction.cancel();\n            reject(error);\n          });\n        }).catch(function (error) {\n          toScanningStateChangeTransaction.cancel();\n          reject(Html5QrcodeStrings.errorGettingUserMedia(error));\n        });\n      }).catch(function (_) {\n        toScanningStateChangeTransaction.cancel();\n        reject(Html5QrcodeStrings.cameraStreamingNotSupported());\n      });\n    });\n  };\n  Html5Qrcode.prototype.pause = function (shouldPauseVideo) {\n    if (!this.stateManagerProxy.isStrictlyScanning()) {\n      throw \"Cannot pause, scanner is not scanning.\";\n    }\n    this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED);\n    this.showPausedState();\n    if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n      shouldPauseVideo = false;\n    }\n    if (shouldPauseVideo && this.renderedCamera) {\n      this.renderedCamera.pause();\n    }\n  };\n  Html5Qrcode.prototype.resume = function () {\n    if (!this.stateManagerProxy.isPaused()) {\n      throw \"Cannot result, scanner is not paused.\";\n    }\n    if (!this.renderedCamera) {\n      throw \"renderedCamera doesn't exist while trying resume()\";\n    }\n    var $this = this;\n    var transitionToScanning = function () {\n      $this.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING);\n      $this.hidePausedState();\n    };\n    if (!this.renderedCamera.isPaused()) {\n      transitionToScanning();\n      return;\n    }\n    this.renderedCamera.resume(function () {\n      transitionToScanning();\n    });\n  };\n  Html5Qrcode.prototype.getState = function () {\n    return this.stateManagerProxy.getState();\n  };\n  Html5Qrcode.prototype.stop = function () {\n    var _this = this;\n    if (!this.stateManagerProxy.isScanning()) {\n      throw \"Cannot stop, scanner is not running or paused.\";\n    }\n    var toStoppedStateTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);\n    this.shouldScan = false;\n    if (this.foreverScanTimeout) {\n      clearTimeout(this.foreverScanTimeout);\n    }\n    var removeQrRegion = function () {\n      if (!_this.element) {\n        return;\n      }\n      var childElement = document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);\n      if (childElement) {\n        _this.element.removeChild(childElement);\n      }\n    };\n    var $this = this;\n    return this.renderedCamera.close().then(function () {\n      $this.renderedCamera = null;\n      if ($this.element) {\n        $this.element.removeChild($this.canvasElement);\n        $this.canvasElement = null;\n      }\n      removeQrRegion();\n      if ($this.qrRegion) {\n        $this.qrRegion = null;\n      }\n      if ($this.context) {\n        $this.context = null;\n      }\n      toStoppedStateTransaction.execute();\n      $this.hidePausedState();\n      $this.isScanning = false;\n      return Promise.resolve();\n    });\n  };\n  Html5Qrcode.prototype.scanFile = function (imageFile, showImage) {\n    return this.scanFileV2(imageFile, showImage).then(function (html5qrcodeResult) {\n      return html5qrcodeResult.decodedText;\n    });\n  };\n  Html5Qrcode.prototype.scanFileV2 = function (imageFile, showImage) {\n    var _this = this;\n    if (!imageFile || !(imageFile instanceof File)) {\n      throw \"imageFile argument is mandatory and should be instance \" + \"of File. Use 'event.target.files[0]'.\";\n    }\n    if (isNullOrUndefined(showImage)) {\n      showImage = true;\n    }\n    if (!this.stateManagerProxy.canScanFile()) {\n      throw \"Cannot start file scan - ongoing camera scan\";\n    }\n    return new Promise(function (resolve, reject) {\n      _this.possiblyCloseLastScanImageFile();\n      _this.clearElement();\n      _this.lastScanImageFile = URL.createObjectURL(imageFile);\n      var inputImage = new Image();\n      inputImage.onload = function () {\n        var imageWidth = inputImage.width;\n        var imageHeight = inputImage.height;\n        var element = document.getElementById(_this.elementId);\n        var containerWidth = element.clientWidth ? element.clientWidth : Constants.DEFAULT_WIDTH;\n        var containerHeight = Math.max(element.clientHeight ? element.clientHeight : imageHeight, Constants.FILE_SCAN_MIN_HEIGHT);\n        var config = _this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n        if (showImage) {\n          var visibleCanvas = _this.createCanvasElement(containerWidth, containerHeight, \"qr-canvas-visible\");\n          visibleCanvas.style.display = \"inline-block\";\n          element.appendChild(visibleCanvas);\n          var context_1 = visibleCanvas.getContext(\"2d\");\n          if (!context_1) {\n            throw \"Unable to get 2d context from canvas\";\n          }\n          context_1.canvas.width = containerWidth;\n          context_1.canvas.height = containerHeight;\n          context_1.drawImage(inputImage, 0, 0, imageWidth, imageHeight, config.x, config.y, config.width, config.height);\n        }\n        var padding = Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING;\n        var hiddenImageWidth = Math.max(inputImage.width, config.width);\n        var hiddenImageHeight = Math.max(inputImage.height, config.height);\n        var hiddenCanvasWidth = hiddenImageWidth + 2 * padding;\n        var hiddenCanvasHeight = hiddenImageHeight + 2 * padding;\n        var hiddenCanvas = _this.createCanvasElement(hiddenCanvasWidth, hiddenCanvasHeight);\n        element.appendChild(hiddenCanvas);\n        var context = hiddenCanvas.getContext(\"2d\");\n        if (!context) {\n          throw \"Unable to get 2d context from canvas\";\n        }\n        context.canvas.width = hiddenCanvasWidth;\n        context.canvas.height = hiddenCanvasHeight;\n        context.drawImage(inputImage, 0, 0, imageWidth, imageHeight, padding, padding, hiddenImageWidth, hiddenImageHeight);\n        try {\n          _this.qrcode.decodeRobustlyAsync(hiddenCanvas).then(function (result) {\n            resolve(Html5QrcodeResultFactory.createFromQrcodeResult(result));\n          }).catch(reject);\n        } catch (exception) {\n          reject(\"QR code parse error, error = \".concat(exception));\n        }\n      };\n      inputImage.onerror = reject;\n      inputImage.onabort = reject;\n      inputImage.onstalled = reject;\n      inputImage.onsuspend = reject;\n      inputImage.src = URL.createObjectURL(imageFile);\n    });\n  };\n  Html5Qrcode.prototype.clear = function () {\n    this.clearElement();\n  };\n  Html5Qrcode.getCameras = function () {\n    return CameraRetriever.retrieve();\n  };\n  Html5Qrcode.prototype.getRunningTrackCapabilities = function () {\n    return this.getRenderedCameraOrFail().getRunningTrackCapabilities();\n  };\n  Html5Qrcode.prototype.getRunningTrackSettings = function () {\n    return this.getRenderedCameraOrFail().getRunningTrackSettings();\n  };\n  Html5Qrcode.prototype.getRunningTrackCameraCapabilities = function () {\n    return this.getRenderedCameraOrFail().getCapabilities();\n  };\n  Html5Qrcode.prototype.applyVideoConstraints = function (videoConstaints) {\n    if (!videoConstaints) {\n      throw \"videoConstaints is required argument.\";\n    } else if (!VideoConstraintsUtil.isMediaStreamConstraintsValid(videoConstaints, this.logger)) {\n      throw \"invalid videoConstaints passed, check logs for more details\";\n    }\n    return this.getRenderedCameraOrFail().applyVideoConstraints(videoConstaints);\n  };\n  Html5Qrcode.prototype.getRenderedCameraOrFail = function () {\n    if (this.renderedCamera == null) {\n      throw \"Scanning is not in running state, call this API only when\" + \" QR code scanning using camera is in running state.\";\n    }\n    return this.renderedCamera;\n  };\n  Html5Qrcode.prototype.getSupportedFormats = function (configOrVerbosityFlag) {\n    var allFormats = [Html5QrcodeSupportedFormats.QR_CODE, Html5QrcodeSupportedFormats.AZTEC, Html5QrcodeSupportedFormats.CODABAR, Html5QrcodeSupportedFormats.CODE_39, Html5QrcodeSupportedFormats.CODE_93, Html5QrcodeSupportedFormats.CODE_128, Html5QrcodeSupportedFormats.DATA_MATRIX, Html5QrcodeSupportedFormats.MAXICODE, Html5QrcodeSupportedFormats.ITF, Html5QrcodeSupportedFormats.EAN_13, Html5QrcodeSupportedFormats.EAN_8, Html5QrcodeSupportedFormats.PDF_417, Html5QrcodeSupportedFormats.RSS_14, Html5QrcodeSupportedFormats.RSS_EXPANDED, Html5QrcodeSupportedFormats.UPC_A, Html5QrcodeSupportedFormats.UPC_E, Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];\n    if (!configOrVerbosityFlag || typeof configOrVerbosityFlag == \"boolean\") {\n      return allFormats;\n    }\n    if (!configOrVerbosityFlag.formatsToSupport) {\n      return allFormats;\n    }\n    if (!Array.isArray(configOrVerbosityFlag.formatsToSupport)) {\n      throw \"configOrVerbosityFlag.formatsToSupport should be undefined \" + \"or an array.\";\n    }\n    if (configOrVerbosityFlag.formatsToSupport.length === 0) {\n      throw \"Atleast 1 formatsToSupport is needed.\";\n    }\n    var supportedFormats = [];\n    for (var _i = 0, _a = configOrVerbosityFlag.formatsToSupport; _i < _a.length; _i++) {\n      var format = _a[_i];\n      if (isValidHtml5QrcodeSupportedFormats(format)) {\n        supportedFormats.push(format);\n      } else {\n        this.logger.warn(\"Invalid format: \".concat(format, \" passed in config, ignoring.\"));\n      }\n    }\n    if (supportedFormats.length === 0) {\n      throw \"None of formatsToSupport match supported values.\";\n    }\n    return supportedFormats;\n  };\n  Html5Qrcode.prototype.getUseBarCodeDetectorIfSupported = function (config) {\n    if (isNullOrUndefined(config)) {\n      return true;\n    }\n    if (!isNullOrUndefined(config.useBarCodeDetectorIfSupported)) {\n      return config.useBarCodeDetectorIfSupported !== false;\n    }\n    if (isNullOrUndefined(config.experimentalFeatures)) {\n      return true;\n    }\n    var experimentalFeatures = config.experimentalFeatures;\n    if (isNullOrUndefined(experimentalFeatures.useBarCodeDetectorIfSupported)) {\n      return true;\n    }\n    return experimentalFeatures.useBarCodeDetectorIfSupported !== false;\n  };\n  Html5Qrcode.prototype.validateQrboxSize = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n    var _this = this;\n    var qrboxSize = internalConfig.qrbox;\n    this.validateQrboxConfig(qrboxSize);\n    var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n    var validateMinSize = function (size) {\n      if (size < Constants.MIN_QR_BOX_SIZE) {\n        throw \"minimum size of 'config.qrbox' dimension value is\" + \" \".concat(Constants.MIN_QR_BOX_SIZE, \"px.\");\n      }\n    };\n    var correctWidthBasedOnRootElementSize = function (configWidth) {\n      if (configWidth > viewfinderWidth) {\n        _this.logger.warn(\"`qrbox.width` or `qrbox` is larger than the\" + \" width of the root element. The width will be truncated\" + \" to the width of root element.\");\n        configWidth = viewfinderWidth;\n      }\n      return configWidth;\n    };\n    validateMinSize(qrDimensions.width);\n    validateMinSize(qrDimensions.height);\n    qrDimensions.width = correctWidthBasedOnRootElementSize(qrDimensions.width);\n  };\n  Html5Qrcode.prototype.validateQrboxConfig = function (qrboxSize) {\n    if (typeof qrboxSize === \"number\") {\n      return;\n    }\n    if (typeof qrboxSize === \"function\") {\n      return;\n    }\n    if (qrboxSize.width === undefined || qrboxSize.height === undefined) {\n      throw \"Invalid instance of QrDimensions passed for \" + \"'config.qrbox'. Both 'width' and 'height' should be set.\";\n    }\n  };\n  Html5Qrcode.prototype.toQrdimensions = function (viewfinderWidth, viewfinderHeight, qrboxSize) {\n    if (typeof qrboxSize === \"number\") {\n      return {\n        width: qrboxSize,\n        height: qrboxSize\n      };\n    } else if (typeof qrboxSize === \"function\") {\n      try {\n        return qrboxSize(viewfinderWidth, viewfinderHeight);\n      } catch (error) {\n        throw new Error(\"qrbox config was passed as a function but it failed with \" + \"unknown error\" + error);\n      }\n    }\n    return qrboxSize;\n  };\n  Html5Qrcode.prototype.setupUi = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n    if (internalConfig.isShadedBoxEnabled()) {\n      this.validateQrboxSize(viewfinderWidth, viewfinderHeight, internalConfig);\n    }\n    var qrboxSize = isNullOrUndefined(internalConfig.qrbox) ? {\n      width: viewfinderWidth,\n      height: viewfinderHeight\n    } : internalConfig.qrbox;\n    this.validateQrboxConfig(qrboxSize);\n    var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n    if (qrDimensions.height > viewfinderHeight) {\n      this.logger.warn(\"[Html5Qrcode] config.qrbox has height that is\" + \"greater than the height of the video stream. Shading will be\" + \" ignored\");\n    }\n    var shouldShadingBeApplied = internalConfig.isShadedBoxEnabled() && qrDimensions.height <= viewfinderHeight;\n    var defaultQrRegion = {\n      x: 0,\n      y: 0,\n      width: viewfinderWidth,\n      height: viewfinderHeight\n    };\n    var qrRegion = shouldShadingBeApplied ? this.getShadedRegionBounds(viewfinderWidth, viewfinderHeight, qrDimensions) : defaultQrRegion;\n    var canvasElement = this.createCanvasElement(qrRegion.width, qrRegion.height);\n    var contextAttributes = {\n      willReadFrequently: true\n    };\n    var context = canvasElement.getContext(\"2d\", contextAttributes);\n    context.canvas.width = qrRegion.width;\n    context.canvas.height = qrRegion.height;\n    this.element.append(canvasElement);\n    if (shouldShadingBeApplied) {\n      this.possiblyInsertShadingElement(this.element, viewfinderWidth, viewfinderHeight, qrDimensions);\n    }\n    this.createScannerPausedUiElement(this.element);\n    this.qrRegion = qrRegion;\n    this.context = context;\n    this.canvasElement = canvasElement;\n  };\n  Html5Qrcode.prototype.createScannerPausedUiElement = function (rootElement) {\n    var scannerPausedUiElement = document.createElement(\"div\");\n    scannerPausedUiElement.innerText = Html5QrcodeStrings.scannerPaused();\n    scannerPausedUiElement.style.display = \"none\";\n    scannerPausedUiElement.style.position = \"absolute\";\n    scannerPausedUiElement.style.top = \"0px\";\n    scannerPausedUiElement.style.zIndex = \"1\";\n    scannerPausedUiElement.style.background = \"rgba(9, 9, 9, 0.46)\";\n    scannerPausedUiElement.style.color = \"#FFECEC\";\n    scannerPausedUiElement.style.textAlign = \"center\";\n    scannerPausedUiElement.style.width = \"100%\";\n    rootElement.appendChild(scannerPausedUiElement);\n    this.scannerPausedUiElement = scannerPausedUiElement;\n  };\n  Html5Qrcode.prototype.scanContext = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n    if (this.stateManagerProxy.isPaused()) {\n      return Promise.resolve(false);\n    }\n    return this.qrcode.decodeAsync(this.canvasElement).then(function (result) {\n      qrCodeSuccessCallback(result.text, Html5QrcodeResultFactory.createFromQrcodeResult(result));\n      _this.possiblyUpdateShaders(true);\n      return true;\n    }).catch(function (error) {\n      _this.possiblyUpdateShaders(false);\n      var errorMessage = Html5QrcodeStrings.codeParseError(error);\n      qrCodeErrorCallback(errorMessage, Html5QrcodeErrorFactory.createFrom(errorMessage));\n      return false;\n    });\n  };\n  Html5Qrcode.prototype.foreverScan = function (internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n    if (!this.shouldScan) {\n      return;\n    }\n    if (!this.renderedCamera) {\n      return;\n    }\n    var videoElement = this.renderedCamera.getSurface();\n    var widthRatio = videoElement.videoWidth / videoElement.clientWidth;\n    var heightRatio = videoElement.videoHeight / videoElement.clientHeight;\n    if (!this.qrRegion) {\n      throw \"qrRegion undefined when localMediaStream is ready.\";\n    }\n    var sWidthOffset = this.qrRegion.width * widthRatio;\n    var sHeightOffset = this.qrRegion.height * heightRatio;\n    var sxOffset = this.qrRegion.x * widthRatio;\n    var syOffset = this.qrRegion.y * heightRatio;\n    this.context.drawImage(videoElement, sxOffset, syOffset, sWidthOffset, sHeightOffset, 0, 0, this.qrRegion.width, this.qrRegion.height);\n    var triggerNextScan = function () {\n      _this.foreverScanTimeout = setTimeout(function () {\n        _this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback);\n      }, _this.getTimeoutFps(internalConfig.fps));\n    };\n    this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback).then(function (isSuccessfull) {\n      if (!isSuccessfull && internalConfig.disableFlip !== true) {\n        _this.context.translate(_this.context.canvas.width, 0);\n        _this.context.scale(-1, 1);\n        _this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback).finally(function () {\n          triggerNextScan();\n        });\n      } else {\n        triggerNextScan();\n      }\n    }).catch(function (error) {\n      _this.logger.logError(\"Error happend while scanning context\", error);\n      triggerNextScan();\n    });\n  };\n  Html5Qrcode.prototype.createVideoConstraints = function (cameraIdOrConfig) {\n    if (typeof cameraIdOrConfig == \"string\") {\n      return {\n        deviceId: {\n          exact: cameraIdOrConfig\n        }\n      };\n    } else if (typeof cameraIdOrConfig == \"object\") {\n      var facingModeKey = \"facingMode\";\n      var deviceIdKey = \"deviceId\";\n      var allowedFacingModeValues_1 = {\n        \"user\": true,\n        \"environment\": true\n      };\n      var exactKey = \"exact\";\n      var isValidFacingModeValue = function (value) {\n        if (value in allowedFacingModeValues_1) {\n          return true;\n        } else {\n          throw \"config has invalid 'facingMode' value = \" + \"'\".concat(value, \"'\");\n        }\n      };\n      var keys = Object.keys(cameraIdOrConfig);\n      if (keys.length !== 1) {\n        throw \"'cameraIdOrConfig' object should have exactly 1 key,\" + \" if passed as an object, found \".concat(keys.length, \" keys\");\n      }\n      var key = Object.keys(cameraIdOrConfig)[0];\n      if (key !== facingModeKey && key !== deviceIdKey) {\n        throw \"Only '\".concat(facingModeKey, \"' and '\").concat(deviceIdKey, \"' \") + \" are supported for 'cameraIdOrConfig'\";\n      }\n      if (key === facingModeKey) {\n        var facingMode = cameraIdOrConfig.facingMode;\n        if (typeof facingMode == \"string\") {\n          if (isValidFacingModeValue(facingMode)) {\n            return {\n              facingMode: facingMode\n            };\n          }\n        } else if (typeof facingMode == \"object\") {\n          if (exactKey in facingMode) {\n            if (isValidFacingModeValue(facingMode[\"\".concat(exactKey)])) {\n              return {\n                facingMode: {\n                  exact: facingMode[\"\".concat(exactKey)]\n                }\n              };\n            }\n          } else {\n            throw \"'facingMode' should be string or object with\" + \" \".concat(exactKey, \" as key.\");\n          }\n        } else {\n          var type_1 = typeof facingMode;\n          throw \"Invalid type of 'facingMode' = \".concat(type_1);\n        }\n      } else {\n        var deviceId = cameraIdOrConfig.deviceId;\n        if (typeof deviceId == \"string\") {\n          return {\n            deviceId: deviceId\n          };\n        } else if (typeof deviceId == \"object\") {\n          if (exactKey in deviceId) {\n            return {\n              deviceId: {\n                exact: deviceId[\"\".concat(exactKey)]\n              }\n            };\n          } else {\n            throw \"'deviceId' should be string or object with\" + \" \".concat(exactKey, \" as key.\");\n          }\n        } else {\n          var type_2 = typeof deviceId;\n          throw \"Invalid type of 'deviceId' = \".concat(type_2);\n        }\n      }\n    }\n    var type = typeof cameraIdOrConfig;\n    throw \"Invalid type of 'cameraIdOrConfig' = \".concat(type);\n  };\n  Html5Qrcode.prototype.computeCanvasDrawConfig = function (imageWidth, imageHeight, containerWidth, containerHeight) {\n    if (imageWidth <= containerWidth && imageHeight <= containerHeight) {\n      var xoffset = (containerWidth - imageWidth) / 2;\n      var yoffset = (containerHeight - imageHeight) / 2;\n      return {\n        x: xoffset,\n        y: yoffset,\n        width: imageWidth,\n        height: imageHeight\n      };\n    } else {\n      var formerImageWidth = imageWidth;\n      var formerImageHeight = imageHeight;\n      if (imageWidth > containerWidth) {\n        imageHeight = containerWidth / imageWidth * imageHeight;\n        imageWidth = containerWidth;\n      }\n      if (imageHeight > containerHeight) {\n        imageWidth = containerHeight / imageHeight * imageWidth;\n        imageHeight = containerHeight;\n      }\n      this.logger.log(\"Image downsampled from \" + \"\".concat(formerImageWidth, \"X\").concat(formerImageHeight) + \" to \".concat(imageWidth, \"X\").concat(imageHeight, \".\"));\n      return this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n    }\n  };\n  Html5Qrcode.prototype.clearElement = function () {\n    if (this.stateManagerProxy.isScanning()) {\n      throw \"Cannot clear while scan is ongoing, close it first.\";\n    }\n    var element = document.getElementById(this.elementId);\n    if (element) {\n      element.innerHTML = \"\";\n    }\n  };\n  Html5Qrcode.prototype.possiblyUpdateShaders = function (qrMatch) {\n    if (this.qrMatch === qrMatch) {\n      return;\n    }\n    if (this.hasBorderShaders && this.borderShaders && this.borderShaders.length) {\n      this.borderShaders.forEach(function (shader) {\n        shader.style.backgroundColor = qrMatch ? Constants.BORDER_SHADER_MATCH_COLOR : Constants.BORDER_SHADER_DEFAULT_COLOR;\n      });\n    }\n    this.qrMatch = qrMatch;\n  };\n  Html5Qrcode.prototype.possiblyCloseLastScanImageFile = function () {\n    if (this.lastScanImageFile) {\n      URL.revokeObjectURL(this.lastScanImageFile);\n      this.lastScanImageFile = null;\n    }\n  };\n  Html5Qrcode.prototype.createCanvasElement = function (width, height, customId) {\n    var canvasWidth = width;\n    var canvasHeight = height;\n    var canvasElement = document.createElement(\"canvas\");\n    canvasElement.style.width = \"\".concat(canvasWidth, \"px\");\n    canvasElement.style.height = \"\".concat(canvasHeight, \"px\");\n    canvasElement.style.display = \"none\";\n    canvasElement.id = isNullOrUndefined(customId) ? \"qr-canvas\" : customId;\n    return canvasElement;\n  };\n  Html5Qrcode.prototype.getShadedRegionBounds = function (width, height, qrboxSize) {\n    if (qrboxSize.width > width || qrboxSize.height > height) {\n      throw \"'config.qrbox' dimensions should not be greater than the \" + \"dimensions of the root HTML element.\";\n    }\n    return {\n      x: (width - qrboxSize.width) / 2,\n      y: (height - qrboxSize.height) / 2,\n      width: qrboxSize.width,\n      height: qrboxSize.height\n    };\n  };\n  Html5Qrcode.prototype.possiblyInsertShadingElement = function (element, width, height, qrboxSize) {\n    if (width - qrboxSize.width < 1 || height - qrboxSize.height < 1) {\n      return;\n    }\n    var shadingElement = document.createElement(\"div\");\n    shadingElement.style.position = \"absolute\";\n    var rightLeftBorderSize = (width - qrboxSize.width) / 2;\n    var topBottomBorderSize = (height - qrboxSize.height) / 2;\n    shadingElement.style.borderLeft = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.borderRight = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.borderTop = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.borderBottom = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.boxSizing = \"border-box\";\n    shadingElement.style.top = \"0px\";\n    shadingElement.style.bottom = \"0px\";\n    shadingElement.style.left = \"0px\";\n    shadingElement.style.right = \"0px\";\n    shadingElement.id = \"\".concat(Constants.SHADED_REGION_ELEMENT_ID);\n    if (width - qrboxSize.width < 11 || height - qrboxSize.height < 11) {\n      this.hasBorderShaders = false;\n    } else {\n      var smallSize = 5;\n      var largeSize = 40;\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, true);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, false);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, true);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, false);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, true);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, true);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, false);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, false);\n      this.hasBorderShaders = true;\n    }\n    element.append(shadingElement);\n  };\n  Html5Qrcode.prototype.insertShaderBorders = function (shaderElem, width, height, top, bottom, side, isLeft) {\n    var elem = document.createElement(\"div\");\n    elem.style.position = \"absolute\";\n    elem.style.backgroundColor = Constants.BORDER_SHADER_DEFAULT_COLOR;\n    elem.style.width = \"\".concat(width, \"px\");\n    elem.style.height = \"\".concat(height, \"px\");\n    if (top !== null) {\n      elem.style.top = \"\".concat(top, \"px\");\n    }\n    if (bottom !== null) {\n      elem.style.bottom = \"\".concat(bottom, \"px\");\n    }\n    if (isLeft) {\n      elem.style.left = \"\".concat(side, \"px\");\n    } else {\n      elem.style.right = \"\".concat(side, \"px\");\n    }\n    if (!this.borderShaders) {\n      this.borderShaders = [];\n    }\n    this.borderShaders.push(elem);\n    shaderElem.appendChild(elem);\n  };\n  Html5Qrcode.prototype.showPausedState = function () {\n    if (!this.scannerPausedUiElement) {\n      throw \"[internal error] scanner paused UI element not found\";\n    }\n    this.scannerPausedUiElement.style.display = \"block\";\n  };\n  Html5Qrcode.prototype.hidePausedState = function () {\n    if (!this.scannerPausedUiElement) {\n      throw \"[internal error] scanner paused UI element not found\";\n    }\n    this.scannerPausedUiElement.style.display = \"none\";\n  };\n  Html5Qrcode.prototype.getTimeoutFps = function (fps) {\n    return 1000 / fps;\n  };\n  return Html5Qrcode;\n}();\nexport { Html5Qrcode };","map":{"version":3,"sources":["../../src/html5-qrcode.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseLoggger, Html5QrcodeResultFactory, Html5QrcodeErrorFactory, Html5QrcodeSupportedFormats, isValidHtml5QrcodeSupportedFormats, Html5QrcodeConstants, isNullOrUndefined } from \"./core\";\nimport { Html5QrcodeStrings } from \"./strings\";\nimport { VideoConstraintsUtil } from \"./utils\";\nimport { Html5QrcodeShim } from \"./code-decoder\";\nimport { CameraFactory } from \"./camera/factories\";\nimport { CameraRetriever } from \"./camera/retriever\";\nimport { StateManagerFactory, Html5QrcodeScannerState } from \"./state-manager\";\nvar Constants = (function (_super) {\n    __extends(Constants, _super);\n    function Constants() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Constants.DEFAULT_WIDTH = 300;\n    Constants.DEFAULT_WIDTH_OFFSET = 2;\n    Constants.FILE_SCAN_MIN_HEIGHT = 300;\n    Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING = 100;\n    Constants.MIN_QR_BOX_SIZE = 50;\n    Constants.SHADED_LEFT = 1;\n    Constants.SHADED_RIGHT = 2;\n    Constants.SHADED_TOP = 3;\n    Constants.SHADED_BOTTOM = 4;\n    Constants.SHADED_REGION_ELEMENT_ID = \"qr-shaded-region\";\n    Constants.VERBOSE = false;\n    Constants.BORDER_SHADER_DEFAULT_COLOR = \"#ffffff\";\n    Constants.BORDER_SHADER_MATCH_COLOR = \"rgb(90, 193, 56)\";\n    return Constants;\n}(Html5QrcodeConstants));\nvar InternalHtml5QrcodeConfig = (function () {\n    function InternalHtml5QrcodeConfig(config, logger) {\n        this.logger = logger;\n        this.fps = Constants.SCAN_DEFAULT_FPS;\n        if (!config) {\n            this.disableFlip = Constants.DEFAULT_DISABLE_FLIP;\n        }\n        else {\n            if (config.fps) {\n                this.fps = config.fps;\n            }\n            this.disableFlip = config.disableFlip === true;\n            this.qrbox = config.qrbox;\n            this.aspectRatio = config.aspectRatio;\n            this.videoConstraints = config.videoConstraints;\n        }\n    }\n    InternalHtml5QrcodeConfig.prototype.isMediaStreamConstraintsValid = function () {\n        if (!this.videoConstraints) {\n            this.logger.logError(\"Empty videoConstraints\", true);\n            return false;\n        }\n        return VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints, this.logger);\n    };\n    InternalHtml5QrcodeConfig.prototype.isShadedBoxEnabled = function () {\n        return !isNullOrUndefined(this.qrbox);\n    };\n    InternalHtml5QrcodeConfig.create = function (config, logger) {\n        return new InternalHtml5QrcodeConfig(config, logger);\n    };\n    return InternalHtml5QrcodeConfig;\n}());\nvar Html5Qrcode = (function () {\n    function Html5Qrcode(elementId, configOrVerbosityFlag) {\n        this.element = null;\n        this.canvasElement = null;\n        this.scannerPausedUiElement = null;\n        this.hasBorderShaders = null;\n        this.borderShaders = null;\n        this.qrMatch = null;\n        this.renderedCamera = null;\n        this.qrRegion = null;\n        this.context = null;\n        this.lastScanImageFile = null;\n        this.isScanning = false;\n        if (!document.getElementById(elementId)) {\n            throw \"HTML Element with id=\".concat(elementId, \" not found\");\n        }\n        this.elementId = elementId;\n        this.verbose = false;\n        var experimentalFeatureConfig;\n        var configObject;\n        if (typeof configOrVerbosityFlag == \"boolean\") {\n            this.verbose = configOrVerbosityFlag === true;\n        }\n        else if (configOrVerbosityFlag) {\n            configObject = configOrVerbosityFlag;\n            this.verbose = configObject.verbose === true;\n            experimentalFeatureConfig = configObject.experimentalFeatures;\n        }\n        this.logger = new BaseLoggger(this.verbose);\n        this.qrcode = new Html5QrcodeShim(this.getSupportedFormats(configOrVerbosityFlag), this.getUseBarCodeDetectorIfSupported(configObject), this.verbose, this.logger);\n        this.foreverScanTimeout;\n        this.shouldScan = true;\n        this.stateManagerProxy = StateManagerFactory.create();\n    }\n    Html5Qrcode.prototype.start = function (cameraIdOrConfig, configuration, qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        if (!cameraIdOrConfig) {\n            throw \"cameraIdOrConfig is required\";\n        }\n        if (!qrCodeSuccessCallback\n            || typeof qrCodeSuccessCallback != \"function\") {\n            throw \"qrCodeSuccessCallback is required and should be a function.\";\n        }\n        var qrCodeErrorCallbackInternal;\n        if (qrCodeErrorCallback) {\n            qrCodeErrorCallbackInternal = qrCodeErrorCallback;\n        }\n        else {\n            qrCodeErrorCallbackInternal\n                = this.verbose ? this.logger.log : function () { };\n        }\n        var internalConfig = InternalHtml5QrcodeConfig.create(configuration, this.logger);\n        this.clearElement();\n        var videoConstraintsAvailableAndValid = false;\n        if (internalConfig.videoConstraints) {\n            if (!internalConfig.isMediaStreamConstraintsValid()) {\n                this.logger.logError(\"'videoConstraints' is not valid 'MediaStreamConstraints, \"\n                    + \"it will be ignored.'\", true);\n            }\n            else {\n                videoConstraintsAvailableAndValid = true;\n            }\n        }\n        var areVideoConstraintsEnabled = videoConstraintsAvailableAndValid;\n        var element = document.getElementById(this.elementId);\n        var rootElementWidth = element.clientWidth\n            ? element.clientWidth : Constants.DEFAULT_WIDTH;\n        element.style.position = \"relative\";\n        this.shouldScan = true;\n        this.element = element;\n        var $this = this;\n        var toScanningStateChangeTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);\n        return new Promise(function (resolve, reject) {\n            var videoConstraints = areVideoConstraintsEnabled\n                ? internalConfig.videoConstraints\n                : $this.createVideoConstraints(cameraIdOrConfig);\n            if (!videoConstraints) {\n                toScanningStateChangeTransaction.cancel();\n                reject(\"videoConstraints should be defined\");\n                return;\n            }\n            var cameraRenderingOptions = {};\n            if (!areVideoConstraintsEnabled || internalConfig.aspectRatio) {\n                cameraRenderingOptions.aspectRatio = internalConfig.aspectRatio;\n            }\n            var renderingCallbacks = {\n                onRenderSurfaceReady: function (viewfinderWidth, viewfinderHeight) {\n                    $this.setupUi(viewfinderWidth, viewfinderHeight, internalConfig);\n                    $this.isScanning = true;\n                    $this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallbackInternal);\n                }\n            };\n            CameraFactory.failIfNotSupported().then(function (factory) {\n                factory.create(videoConstraints).then(function (camera) {\n                    return camera.render(_this.element, cameraRenderingOptions, renderingCallbacks)\n                        .then(function (renderedCamera) {\n                        $this.renderedCamera = renderedCamera;\n                        toScanningStateChangeTransaction.execute();\n                        resolve(null);\n                    })\n                        .catch(function (error) {\n                        toScanningStateChangeTransaction.cancel();\n                        reject(error);\n                    });\n                }).catch(function (error) {\n                    toScanningStateChangeTransaction.cancel();\n                    reject(Html5QrcodeStrings.errorGettingUserMedia(error));\n                });\n            }).catch(function (_) {\n                toScanningStateChangeTransaction.cancel();\n                reject(Html5QrcodeStrings.cameraStreamingNotSupported());\n            });\n        });\n    };\n    Html5Qrcode.prototype.pause = function (shouldPauseVideo) {\n        if (!this.stateManagerProxy.isStrictlyScanning()) {\n            throw \"Cannot pause, scanner is not scanning.\";\n        }\n        this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED);\n        this.showPausedState();\n        if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n            shouldPauseVideo = false;\n        }\n        if (shouldPauseVideo && this.renderedCamera) {\n            this.renderedCamera.pause();\n        }\n    };\n    Html5Qrcode.prototype.resume = function () {\n        if (!this.stateManagerProxy.isPaused()) {\n            throw \"Cannot result, scanner is not paused.\";\n        }\n        if (!this.renderedCamera) {\n            throw \"renderedCamera doesn't exist while trying resume()\";\n        }\n        var $this = this;\n        var transitionToScanning = function () {\n            $this.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING);\n            $this.hidePausedState();\n        };\n        if (!this.renderedCamera.isPaused()) {\n            transitionToScanning();\n            return;\n        }\n        this.renderedCamera.resume(function () {\n            transitionToScanning();\n        });\n    };\n    Html5Qrcode.prototype.getState = function () {\n        return this.stateManagerProxy.getState();\n    };\n    Html5Qrcode.prototype.stop = function () {\n        var _this = this;\n        if (!this.stateManagerProxy.isScanning()) {\n            throw \"Cannot stop, scanner is not running or paused.\";\n        }\n        var toStoppedStateTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);\n        this.shouldScan = false;\n        if (this.foreverScanTimeout) {\n            clearTimeout(this.foreverScanTimeout);\n        }\n        var removeQrRegion = function () {\n            if (!_this.element) {\n                return;\n            }\n            var childElement = document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);\n            if (childElement) {\n                _this.element.removeChild(childElement);\n            }\n        };\n        var $this = this;\n        return this.renderedCamera.close().then(function () {\n            $this.renderedCamera = null;\n            if ($this.element) {\n                $this.element.removeChild($this.canvasElement);\n                $this.canvasElement = null;\n            }\n            removeQrRegion();\n            if ($this.qrRegion) {\n                $this.qrRegion = null;\n            }\n            if ($this.context) {\n                $this.context = null;\n            }\n            toStoppedStateTransaction.execute();\n            $this.hidePausedState();\n            $this.isScanning = false;\n            return Promise.resolve();\n        });\n    };\n    Html5Qrcode.prototype.scanFile = function (imageFile, showImage) {\n        return this.scanFileV2(imageFile, showImage)\n            .then(function (html5qrcodeResult) { return html5qrcodeResult.decodedText; });\n    };\n    Html5Qrcode.prototype.scanFileV2 = function (imageFile, showImage) {\n        var _this = this;\n        if (!imageFile || !(imageFile instanceof File)) {\n            throw \"imageFile argument is mandatory and should be instance \"\n                + \"of File. Use 'event.target.files[0]'.\";\n        }\n        if (isNullOrUndefined(showImage)) {\n            showImage = true;\n        }\n        if (!this.stateManagerProxy.canScanFile()) {\n            throw \"Cannot start file scan - ongoing camera scan\";\n        }\n        return new Promise(function (resolve, reject) {\n            _this.possiblyCloseLastScanImageFile();\n            _this.clearElement();\n            _this.lastScanImageFile = URL.createObjectURL(imageFile);\n            var inputImage = new Image;\n            inputImage.onload = function () {\n                var imageWidth = inputImage.width;\n                var imageHeight = inputImage.height;\n                var element = document.getElementById(_this.elementId);\n                var containerWidth = element.clientWidth\n                    ? element.clientWidth : Constants.DEFAULT_WIDTH;\n                var containerHeight = Math.max(element.clientHeight ? element.clientHeight : imageHeight, Constants.FILE_SCAN_MIN_HEIGHT);\n                var config = _this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n                if (showImage) {\n                    var visibleCanvas = _this.createCanvasElement(containerWidth, containerHeight, \"qr-canvas-visible\");\n                    visibleCanvas.style.display = \"inline-block\";\n                    element.appendChild(visibleCanvas);\n                    var context_1 = visibleCanvas.getContext(\"2d\");\n                    if (!context_1) {\n                        throw \"Unable to get 2d context from canvas\";\n                    }\n                    context_1.canvas.width = containerWidth;\n                    context_1.canvas.height = containerHeight;\n                    context_1.drawImage(inputImage, 0, 0, imageWidth, imageHeight, config.x, config.y, config.width, config.height);\n                }\n                var padding = Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING;\n                var hiddenImageWidth = Math.max(inputImage.width, config.width);\n                var hiddenImageHeight = Math.max(inputImage.height, config.height);\n                var hiddenCanvasWidth = hiddenImageWidth + 2 * padding;\n                var hiddenCanvasHeight = hiddenImageHeight + 2 * padding;\n                var hiddenCanvas = _this.createCanvasElement(hiddenCanvasWidth, hiddenCanvasHeight);\n                element.appendChild(hiddenCanvas);\n                var context = hiddenCanvas.getContext(\"2d\");\n                if (!context) {\n                    throw \"Unable to get 2d context from canvas\";\n                }\n                context.canvas.width = hiddenCanvasWidth;\n                context.canvas.height = hiddenCanvasHeight;\n                context.drawImage(inputImage, 0, 0, imageWidth, imageHeight, padding, padding, hiddenImageWidth, hiddenImageHeight);\n                try {\n                    _this.qrcode.decodeRobustlyAsync(hiddenCanvas)\n                        .then(function (result) {\n                        resolve(Html5QrcodeResultFactory.createFromQrcodeResult(result));\n                    })\n                        .catch(reject);\n                }\n                catch (exception) {\n                    reject(\"QR code parse error, error = \".concat(exception));\n                }\n            };\n            inputImage.onerror = reject;\n            inputImage.onabort = reject;\n            inputImage.onstalled = reject;\n            inputImage.onsuspend = reject;\n            inputImage.src = URL.createObjectURL(imageFile);\n        });\n    };\n    Html5Qrcode.prototype.clear = function () {\n        this.clearElement();\n    };\n    Html5Qrcode.getCameras = function () {\n        return CameraRetriever.retrieve();\n    };\n    Html5Qrcode.prototype.getRunningTrackCapabilities = function () {\n        return this.getRenderedCameraOrFail().getRunningTrackCapabilities();\n    };\n    Html5Qrcode.prototype.getRunningTrackSettings = function () {\n        return this.getRenderedCameraOrFail().getRunningTrackSettings();\n    };\n    Html5Qrcode.prototype.getRunningTrackCameraCapabilities = function () {\n        return this.getRenderedCameraOrFail().getCapabilities();\n    };\n    Html5Qrcode.prototype.applyVideoConstraints = function (videoConstaints) {\n        if (!videoConstaints) {\n            throw \"videoConstaints is required argument.\";\n        }\n        else if (!VideoConstraintsUtil.isMediaStreamConstraintsValid(videoConstaints, this.logger)) {\n            throw \"invalid videoConstaints passed, check logs for more details\";\n        }\n        return this.getRenderedCameraOrFail().applyVideoConstraints(videoConstaints);\n    };\n    Html5Qrcode.prototype.getRenderedCameraOrFail = function () {\n        if (this.renderedCamera == null) {\n            throw \"Scanning is not in running state, call this API only when\"\n                + \" QR code scanning using camera is in running state.\";\n        }\n        return this.renderedCamera;\n    };\n    Html5Qrcode.prototype.getSupportedFormats = function (configOrVerbosityFlag) {\n        var allFormats = [\n            Html5QrcodeSupportedFormats.QR_CODE,\n            Html5QrcodeSupportedFormats.AZTEC,\n            Html5QrcodeSupportedFormats.CODABAR,\n            Html5QrcodeSupportedFormats.CODE_39,\n            Html5QrcodeSupportedFormats.CODE_93,\n            Html5QrcodeSupportedFormats.CODE_128,\n            Html5QrcodeSupportedFormats.DATA_MATRIX,\n            Html5QrcodeSupportedFormats.MAXICODE,\n            Html5QrcodeSupportedFormats.ITF,\n            Html5QrcodeSupportedFormats.EAN_13,\n            Html5QrcodeSupportedFormats.EAN_8,\n            Html5QrcodeSupportedFormats.PDF_417,\n            Html5QrcodeSupportedFormats.RSS_14,\n            Html5QrcodeSupportedFormats.RSS_EXPANDED,\n            Html5QrcodeSupportedFormats.UPC_A,\n            Html5QrcodeSupportedFormats.UPC_E,\n            Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,\n        ];\n        if (!configOrVerbosityFlag\n            || typeof configOrVerbosityFlag == \"boolean\") {\n            return allFormats;\n        }\n        if (!configOrVerbosityFlag.formatsToSupport) {\n            return allFormats;\n        }\n        if (!Array.isArray(configOrVerbosityFlag.formatsToSupport)) {\n            throw \"configOrVerbosityFlag.formatsToSupport should be undefined \"\n                + \"or an array.\";\n        }\n        if (configOrVerbosityFlag.formatsToSupport.length === 0) {\n            throw \"Atleast 1 formatsToSupport is needed.\";\n        }\n        var supportedFormats = [];\n        for (var _i = 0, _a = configOrVerbosityFlag.formatsToSupport; _i < _a.length; _i++) {\n            var format = _a[_i];\n            if (isValidHtml5QrcodeSupportedFormats(format)) {\n                supportedFormats.push(format);\n            }\n            else {\n                this.logger.warn(\"Invalid format: \".concat(format, \" passed in config, ignoring.\"));\n            }\n        }\n        if (supportedFormats.length === 0) {\n            throw \"None of formatsToSupport match supported values.\";\n        }\n        return supportedFormats;\n    };\n    Html5Qrcode.prototype.getUseBarCodeDetectorIfSupported = function (config) {\n        if (isNullOrUndefined(config)) {\n            return true;\n        }\n        if (!isNullOrUndefined(config.useBarCodeDetectorIfSupported)) {\n            return config.useBarCodeDetectorIfSupported !== false;\n        }\n        if (isNullOrUndefined(config.experimentalFeatures)) {\n            return true;\n        }\n        var experimentalFeatures = config.experimentalFeatures;\n        if (isNullOrUndefined(experimentalFeatures.useBarCodeDetectorIfSupported)) {\n            return true;\n        }\n        return experimentalFeatures.useBarCodeDetectorIfSupported !== false;\n    };\n    Html5Qrcode.prototype.validateQrboxSize = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n        var _this = this;\n        var qrboxSize = internalConfig.qrbox;\n        this.validateQrboxConfig(qrboxSize);\n        var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n        var validateMinSize = function (size) {\n            if (size < Constants.MIN_QR_BOX_SIZE) {\n                throw \"minimum size of 'config.qrbox' dimension value is\"\n                    + \" \".concat(Constants.MIN_QR_BOX_SIZE, \"px.\");\n            }\n        };\n        var correctWidthBasedOnRootElementSize = function (configWidth) {\n            if (configWidth > viewfinderWidth) {\n                _this.logger.warn(\"`qrbox.width` or `qrbox` is larger than the\"\n                    + \" width of the root element. The width will be truncated\"\n                    + \" to the width of root element.\");\n                configWidth = viewfinderWidth;\n            }\n            return configWidth;\n        };\n        validateMinSize(qrDimensions.width);\n        validateMinSize(qrDimensions.height);\n        qrDimensions.width = correctWidthBasedOnRootElementSize(qrDimensions.width);\n    };\n    Html5Qrcode.prototype.validateQrboxConfig = function (qrboxSize) {\n        if (typeof qrboxSize === \"number\") {\n            return;\n        }\n        if (typeof qrboxSize === \"function\") {\n            return;\n        }\n        if (qrboxSize.width === undefined || qrboxSize.height === undefined) {\n            throw \"Invalid instance of QrDimensions passed for \"\n                + \"'config.qrbox'. Both 'width' and 'height' should be set.\";\n        }\n    };\n    Html5Qrcode.prototype.toQrdimensions = function (viewfinderWidth, viewfinderHeight, qrboxSize) {\n        if (typeof qrboxSize === \"number\") {\n            return { width: qrboxSize, height: qrboxSize };\n        }\n        else if (typeof qrboxSize === \"function\") {\n            try {\n                return qrboxSize(viewfinderWidth, viewfinderHeight);\n            }\n            catch (error) {\n                throw new Error(\"qrbox config was passed as a function but it failed with \"\n                    + \"unknown error\" + error);\n            }\n        }\n        return qrboxSize;\n    };\n    Html5Qrcode.prototype.setupUi = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n        if (internalConfig.isShadedBoxEnabled()) {\n            this.validateQrboxSize(viewfinderWidth, viewfinderHeight, internalConfig);\n        }\n        var qrboxSize = isNullOrUndefined(internalConfig.qrbox) ?\n            { width: viewfinderWidth, height: viewfinderHeight } : internalConfig.qrbox;\n        this.validateQrboxConfig(qrboxSize);\n        var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n        if (qrDimensions.height > viewfinderHeight) {\n            this.logger.warn(\"[Html5Qrcode] config.qrbox has height that is\"\n                + \"greater than the height of the video stream. Shading will be\"\n                + \" ignored\");\n        }\n        var shouldShadingBeApplied = internalConfig.isShadedBoxEnabled()\n            && qrDimensions.height <= viewfinderHeight;\n        var defaultQrRegion = {\n            x: 0,\n            y: 0,\n            width: viewfinderWidth,\n            height: viewfinderHeight\n        };\n        var qrRegion = shouldShadingBeApplied\n            ? this.getShadedRegionBounds(viewfinderWidth, viewfinderHeight, qrDimensions)\n            : defaultQrRegion;\n        var canvasElement = this.createCanvasElement(qrRegion.width, qrRegion.height);\n        var contextAttributes = { willReadFrequently: true };\n        var context = canvasElement.getContext(\"2d\", contextAttributes);\n        context.canvas.width = qrRegion.width;\n        context.canvas.height = qrRegion.height;\n        this.element.append(canvasElement);\n        if (shouldShadingBeApplied) {\n            this.possiblyInsertShadingElement(this.element, viewfinderWidth, viewfinderHeight, qrDimensions);\n        }\n        this.createScannerPausedUiElement(this.element);\n        this.qrRegion = qrRegion;\n        this.context = context;\n        this.canvasElement = canvasElement;\n    };\n    Html5Qrcode.prototype.createScannerPausedUiElement = function (rootElement) {\n        var scannerPausedUiElement = document.createElement(\"div\");\n        scannerPausedUiElement.innerText = Html5QrcodeStrings.scannerPaused();\n        scannerPausedUiElement.style.display = \"none\";\n        scannerPausedUiElement.style.position = \"absolute\";\n        scannerPausedUiElement.style.top = \"0px\";\n        scannerPausedUiElement.style.zIndex = \"1\";\n        scannerPausedUiElement.style.background = \"rgba(9, 9, 9, 0.46)\";\n        scannerPausedUiElement.style.color = \"#FFECEC\";\n        scannerPausedUiElement.style.textAlign = \"center\";\n        scannerPausedUiElement.style.width = \"100%\";\n        rootElement.appendChild(scannerPausedUiElement);\n        this.scannerPausedUiElement = scannerPausedUiElement;\n    };\n    Html5Qrcode.prototype.scanContext = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        if (this.stateManagerProxy.isPaused()) {\n            return Promise.resolve(false);\n        }\n        return this.qrcode.decodeAsync(this.canvasElement)\n            .then(function (result) {\n            qrCodeSuccessCallback(result.text, Html5QrcodeResultFactory.createFromQrcodeResult(result));\n            _this.possiblyUpdateShaders(true);\n            return true;\n        }).catch(function (error) {\n            _this.possiblyUpdateShaders(false);\n            var errorMessage = Html5QrcodeStrings.codeParseError(error);\n            qrCodeErrorCallback(errorMessage, Html5QrcodeErrorFactory.createFrom(errorMessage));\n            return false;\n        });\n    };\n    Html5Qrcode.prototype.foreverScan = function (internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        if (!this.shouldScan) {\n            return;\n        }\n        if (!this.renderedCamera) {\n            return;\n        }\n        var videoElement = this.renderedCamera.getSurface();\n        var widthRatio = videoElement.videoWidth / videoElement.clientWidth;\n        var heightRatio = videoElement.videoHeight / videoElement.clientHeight;\n        if (!this.qrRegion) {\n            throw \"qrRegion undefined when localMediaStream is ready.\";\n        }\n        var sWidthOffset = this.qrRegion.width * widthRatio;\n        var sHeightOffset = this.qrRegion.height * heightRatio;\n        var sxOffset = this.qrRegion.x * widthRatio;\n        var syOffset = this.qrRegion.y * heightRatio;\n        this.context.drawImage(videoElement, sxOffset, syOffset, sWidthOffset, sHeightOffset, 0, 0, this.qrRegion.width, this.qrRegion.height);\n        var triggerNextScan = function () {\n            _this.foreverScanTimeout = setTimeout(function () {\n                _this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback);\n            }, _this.getTimeoutFps(internalConfig.fps));\n        };\n        this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback)\n            .then(function (isSuccessfull) {\n            if (!isSuccessfull && internalConfig.disableFlip !== true) {\n                _this.context.translate(_this.context.canvas.width, 0);\n                _this.context.scale(-1, 1);\n                _this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback)\n                    .finally(function () {\n                    triggerNextScan();\n                });\n            }\n            else {\n                triggerNextScan();\n            }\n        }).catch(function (error) {\n            _this.logger.logError(\"Error happend while scanning context\", error);\n            triggerNextScan();\n        });\n    };\n    Html5Qrcode.prototype.createVideoConstraints = function (cameraIdOrConfig) {\n        if (typeof cameraIdOrConfig == \"string\") {\n            return { deviceId: { exact: cameraIdOrConfig } };\n        }\n        else if (typeof cameraIdOrConfig == \"object\") {\n            var facingModeKey = \"facingMode\";\n            var deviceIdKey = \"deviceId\";\n            var allowedFacingModeValues_1 = { \"user\": true, \"environment\": true };\n            var exactKey = \"exact\";\n            var isValidFacingModeValue = function (value) {\n                if (value in allowedFacingModeValues_1) {\n                    return true;\n                }\n                else {\n                    throw \"config has invalid 'facingMode' value = \"\n                        + \"'\".concat(value, \"'\");\n                }\n            };\n            var keys = Object.keys(cameraIdOrConfig);\n            if (keys.length !== 1) {\n                throw \"'cameraIdOrConfig' object should have exactly 1 key,\"\n                    + \" if passed as an object, found \".concat(keys.length, \" keys\");\n            }\n            var key = Object.keys(cameraIdOrConfig)[0];\n            if (key !== facingModeKey && key !== deviceIdKey) {\n                throw \"Only '\".concat(facingModeKey, \"' and '\").concat(deviceIdKey, \"' \")\n                    + \" are supported for 'cameraIdOrConfig'\";\n            }\n            if (key === facingModeKey) {\n                var facingMode = cameraIdOrConfig.facingMode;\n                if (typeof facingMode == \"string\") {\n                    if (isValidFacingModeValue(facingMode)) {\n                        return { facingMode: facingMode };\n                    }\n                }\n                else if (typeof facingMode == \"object\") {\n                    if (exactKey in facingMode) {\n                        if (isValidFacingModeValue(facingMode[\"\".concat(exactKey)])) {\n                            return {\n                                facingMode: {\n                                    exact: facingMode[\"\".concat(exactKey)]\n                                }\n                            };\n                        }\n                    }\n                    else {\n                        throw \"'facingMode' should be string or object with\"\n                            + \" \".concat(exactKey, \" as key.\");\n                    }\n                }\n                else {\n                    var type_1 = (typeof facingMode);\n                    throw \"Invalid type of 'facingMode' = \".concat(type_1);\n                }\n            }\n            else {\n                var deviceId = cameraIdOrConfig.deviceId;\n                if (typeof deviceId == \"string\") {\n                    return { deviceId: deviceId };\n                }\n                else if (typeof deviceId == \"object\") {\n                    if (exactKey in deviceId) {\n                        return {\n                            deviceId: { exact: deviceId[\"\".concat(exactKey)] }\n                        };\n                    }\n                    else {\n                        throw \"'deviceId' should be string or object with\"\n                            + \" \".concat(exactKey, \" as key.\");\n                    }\n                }\n                else {\n                    var type_2 = (typeof deviceId);\n                    throw \"Invalid type of 'deviceId' = \".concat(type_2);\n                }\n            }\n        }\n        var type = (typeof cameraIdOrConfig);\n        throw \"Invalid type of 'cameraIdOrConfig' = \".concat(type);\n    };\n    Html5Qrcode.prototype.computeCanvasDrawConfig = function (imageWidth, imageHeight, containerWidth, containerHeight) {\n        if (imageWidth <= containerWidth\n            && imageHeight <= containerHeight) {\n            var xoffset = (containerWidth - imageWidth) / 2;\n            var yoffset = (containerHeight - imageHeight) / 2;\n            return {\n                x: xoffset,\n                y: yoffset,\n                width: imageWidth,\n                height: imageHeight\n            };\n        }\n        else {\n            var formerImageWidth = imageWidth;\n            var formerImageHeight = imageHeight;\n            if (imageWidth > containerWidth) {\n                imageHeight = (containerWidth / imageWidth) * imageHeight;\n                imageWidth = containerWidth;\n            }\n            if (imageHeight > containerHeight) {\n                imageWidth = (containerHeight / imageHeight) * imageWidth;\n                imageHeight = containerHeight;\n            }\n            this.logger.log(\"Image downsampled from \"\n                + \"\".concat(formerImageWidth, \"X\").concat(formerImageHeight)\n                + \" to \".concat(imageWidth, \"X\").concat(imageHeight, \".\"));\n            return this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n        }\n    };\n    Html5Qrcode.prototype.clearElement = function () {\n        if (this.stateManagerProxy.isScanning()) {\n            throw \"Cannot clear while scan is ongoing, close it first.\";\n        }\n        var element = document.getElementById(this.elementId);\n        if (element) {\n            element.innerHTML = \"\";\n        }\n    };\n    Html5Qrcode.prototype.possiblyUpdateShaders = function (qrMatch) {\n        if (this.qrMatch === qrMatch) {\n            return;\n        }\n        if (this.hasBorderShaders\n            && this.borderShaders\n            && this.borderShaders.length) {\n            this.borderShaders.forEach(function (shader) {\n                shader.style.backgroundColor = qrMatch\n                    ? Constants.BORDER_SHADER_MATCH_COLOR\n                    : Constants.BORDER_SHADER_DEFAULT_COLOR;\n            });\n        }\n        this.qrMatch = qrMatch;\n    };\n    Html5Qrcode.prototype.possiblyCloseLastScanImageFile = function () {\n        if (this.lastScanImageFile) {\n            URL.revokeObjectURL(this.lastScanImageFile);\n            this.lastScanImageFile = null;\n        }\n    };\n    Html5Qrcode.prototype.createCanvasElement = function (width, height, customId) {\n        var canvasWidth = width;\n        var canvasHeight = height;\n        var canvasElement = document.createElement(\"canvas\");\n        canvasElement.style.width = \"\".concat(canvasWidth, \"px\");\n        canvasElement.style.height = \"\".concat(canvasHeight, \"px\");\n        canvasElement.style.display = \"none\";\n        canvasElement.id = isNullOrUndefined(customId)\n            ? \"qr-canvas\" : customId;\n        return canvasElement;\n    };\n    Html5Qrcode.prototype.getShadedRegionBounds = function (width, height, qrboxSize) {\n        if (qrboxSize.width > width || qrboxSize.height > height) {\n            throw \"'config.qrbox' dimensions should not be greater than the \"\n                + \"dimensions of the root HTML element.\";\n        }\n        return {\n            x: (width - qrboxSize.width) / 2,\n            y: (height - qrboxSize.height) / 2,\n            width: qrboxSize.width,\n            height: qrboxSize.height\n        };\n    };\n    Html5Qrcode.prototype.possiblyInsertShadingElement = function (element, width, height, qrboxSize) {\n        if ((width - qrboxSize.width) < 1 || (height - qrboxSize.height) < 1) {\n            return;\n        }\n        var shadingElement = document.createElement(\"div\");\n        shadingElement.style.position = \"absolute\";\n        var rightLeftBorderSize = (width - qrboxSize.width) / 2;\n        var topBottomBorderSize = (height - qrboxSize.height) / 2;\n        shadingElement.style.borderLeft\n            = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.borderRight\n            = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.borderTop\n            = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.borderBottom\n            = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.boxSizing = \"border-box\";\n        shadingElement.style.top = \"0px\";\n        shadingElement.style.bottom = \"0px\";\n        shadingElement.style.left = \"0px\";\n        shadingElement.style.right = \"0px\";\n        shadingElement.id = \"\".concat(Constants.SHADED_REGION_ELEMENT_ID);\n        if ((width - qrboxSize.width) < 11\n            || (height - qrboxSize.height) < 11) {\n            this.hasBorderShaders = false;\n        }\n        else {\n            var smallSize = 5;\n            var largeSize = 40;\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, true);\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, false);\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, true);\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, false);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, true);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, true);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, false);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, false);\n            this.hasBorderShaders = true;\n        }\n        element.append(shadingElement);\n    };\n    Html5Qrcode.prototype.insertShaderBorders = function (shaderElem, width, height, top, bottom, side, isLeft) {\n        var elem = document.createElement(\"div\");\n        elem.style.position = \"absolute\";\n        elem.style.backgroundColor = Constants.BORDER_SHADER_DEFAULT_COLOR;\n        elem.style.width = \"\".concat(width, \"px\");\n        elem.style.height = \"\".concat(height, \"px\");\n        if (top !== null) {\n            elem.style.top = \"\".concat(top, \"px\");\n        }\n        if (bottom !== null) {\n            elem.style.bottom = \"\".concat(bottom, \"px\");\n        }\n        if (isLeft) {\n            elem.style.left = \"\".concat(side, \"px\");\n        }\n        else {\n            elem.style.right = \"\".concat(side, \"px\");\n        }\n        if (!this.borderShaders) {\n            this.borderShaders = [];\n        }\n        this.borderShaders.push(elem);\n        shaderElem.appendChild(elem);\n    };\n    Html5Qrcode.prototype.showPausedState = function () {\n        if (!this.scannerPausedUiElement) {\n            throw \"[internal error] scanner paused UI element not found\";\n        }\n        this.scannerPausedUiElement.style.display = \"block\";\n    };\n    Html5Qrcode.prototype.hidePausedState = function () {\n        if (!this.scannerPausedUiElement) {\n            throw \"[internal error] scanner paused UI element not found\";\n        }\n        this.scannerPausedUiElement.style.display = \"none\";\n    };\n    Html5Qrcode.prototype.getTimeoutFps = function (fps) {\n        return 1000 / fps;\n    };\n    return Html5Qrcode;\n}());\nexport { Html5Qrcode };\n//# sourceMappingURL=html5-qrcode.js.map"]},"metadata":{},"sourceType":"module"}